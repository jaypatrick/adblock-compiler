<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>React PoC - Adblock Compiler</title>

        <!-- React 18 + React Router v6 via CDN (development builds for PoC only)
             NOTE: These are *.development.js builds which include additional debugging code,
             are larger, and may expose internal details. For ANY production deployment these
             MUST be replaced with the corresponding *.production.min.js builds:
               react.production.min.js
               react-dom.production.min.js
               react-router-dom.production.min.js -->
        <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
        <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
        <script src="https://unpkg.com/react-router-dom@6.21.0/dist/umd/react-router-dom.development.js"></script>

        <!-- Babel Standalone for JSX transformation -->
        <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

        <style>
            /* =================================================================
               CSS Variables - Theming System
               React Pattern: CSS custom properties for theme management
               ================================================================= */
            :root {
                /* Brand Colors */
                --bg-gradient-start: #667eea;
                --bg-gradient-end: #764ba2;
                --primary: #667eea;
                --primary-dark: #5568d3;
                --secondary: #764ba2;

                /* Light Theme (Default) */
                --container-bg: #ffffff;
                --text-color: #333333;
                --text-muted: #666666;
                --border-color: #e0e0e0;
                --input-bg: #ffffff;
                --section-bg: #f8f9fa;
                --card-bg: #ffffff;
                --button-hover: #f5f5f5;

                /* Status Colors */
                --success: #10b981;
                --danger: #ef4444;
                --warning: #f59e0b;
                --info: #3b82f6;
            }

            /* Dark Theme */
            [data-theme='dark'] {
                --bg-gradient-start: #1a1a2e;
                --bg-gradient-end: #16213e;
                --container-bg: #1e1e2e;
                --text-color: #e0e0e0;
                --text-muted: #a0a0a0;
                --border-color: #3a3a4a;
                --input-bg: #2a2a3a;
                --section-bg: #252535;
                --card-bg: #2a2a3a;
                --button-hover: #3a3a4a;
            }

            /* =================================================================
               Base Styles
               ================================================================= */
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }

            body {
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
                background: linear-gradient(135deg, var(--bg-gradient-start) 0%, var(--bg-gradient-end) 100%);
                min-height: 100vh;
                color: var(--text-color);
                transition: background 0.3s ease;
            }

            /* =================================================================
               Layout Components
               ================================================================= */
            .app-container {
                max-width: 1200px;
                margin: 0 auto;
                padding: 20px;
            }

            /* Navigation */
            .nav {
                background: var(--container-bg);
                border-radius: 12px;
                padding: 20px;
                margin-bottom: 20px;
                box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
                display: flex;
                justify-content: space-between;
                align-items: center;
            }

            .nav-links {
                display: flex;
                gap: 20px;
                list-style: none;
            }

            .nav-link {
                color: var(--text-muted);
                text-decoration: none;
                padding: 8px 16px;
                border-radius: 6px;
                transition: all 0.3s ease;
                font-weight: 500;
            }

            .nav-link:hover {
                background: var(--button-hover);
                color: var(--primary);
            }

            .nav-link.active {
                background: var(--primary);
                color: white;
            }

            /* Theme Toggle */
            .theme-toggle {
                background: var(--section-bg);
                border: 1px solid var(--border-color);
                color: var(--text-color);
                padding: 8px 16px;
                border-radius: 6px;
                cursor: pointer;
                font-size: 14px;
                transition: all 0.3s ease;
            }

            .theme-toggle:hover {
                background: var(--button-hover);
                transform: translateY(-2px);
            }

            /* Main Content */
            .main-content {
                background: var(--container-bg);
                border-radius: 12px;
                padding: 30px;
                box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
                min-height: 400px;
            }

            /* =================================================================
               Component Styles
               ================================================================= */

            /* Stats Cards (Home Page) */
            .stats-grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
                gap: 20px;
                margin: 30px 0;
            }

            .stat-card {
                background: var(--section-bg);
                padding: 24px;
                border-radius: 8px;
                border: 1px solid var(--border-color);
                transition: transform 0.3s ease, box-shadow 0.3s ease;
            }

            .stat-card:hover {
                transform: translateY(-4px);
                box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
            }

            .stat-label {
                color: var(--text-muted);
                font-size: 14px;
                margin-bottom: 8px;
            }

            .stat-value {
                font-size: 32px;
                font-weight: 700;
                color: var(--primary);
            }

            /* Compiler Form */
            .form-section {
                margin-bottom: 30px;
            }

            .form-section h3 {
                margin-bottom: 15px;
                color: var(--text-color);
            }

            .url-list {
                display: flex;
                flex-direction: column;
                gap: 10px;
                margin-bottom: 15px;
            }

            .url-input-row {
                display: flex;
                gap: 10px;
            }

            .input {
                flex: 1;
                padding: 12px;
                border: 1px solid var(--border-color);
                border-radius: 6px;
                background: var(--input-bg);
                color: var(--text-color);
                font-size: 14px;
                transition: border-color 0.3s ease;
            }

            .input:focus {
                outline: none;
                border-color: var(--primary);
            }

            .btn {
                padding: 12px 24px;
                border: none;
                border-radius: 6px;
                font-size: 14px;
                font-weight: 600;
                cursor: pointer;
                transition: all 0.3s ease;
            }

            .btn-primary {
                background: var(--primary);
                color: white;
            }

            .btn-primary:hover:not(:disabled) {
                background: var(--primary-dark);
                transform: translateY(-2px);
                box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            }

            .btn-secondary {
                background: var(--section-bg);
                color: var(--text-color);
                border: 1px solid var(--border-color);
            }

            .btn-secondary:hover {
                background: var(--button-hover);
            }

            .btn-danger {
                background: var(--danger);
                color: white;
            }

            .btn-danger:hover {
                opacity: 0.9;
            }

            .btn:disabled {
                opacity: 0.5;
                cursor: not-allowed;
            }

            /* Transformations Checkboxes */
            .transformations-grid {
                display: grid;
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
                gap: 12px;
                margin-top: 15px;
            }

            .checkbox-label {
                display: flex;
                align-items: center;
                gap: 8px;
                padding: 10px;
                background: var(--section-bg);
                border-radius: 6px;
                cursor: pointer;
                transition: background 0.3s ease;
            }

            .checkbox-label:hover {
                background: var(--button-hover);
            }

            .checkbox-label input[type='checkbox'] {
                width: 18px;
                height: 18px;
                cursor: pointer;
            }

            /* Results Display */
            .results-container {
                margin-top: 30px;
                padding: 20px;
                background: var(--section-bg);
                border-radius: 8px;
                border: 1px solid var(--border-color);
            }

            .results-container h3 {
                margin-bottom: 15px;
                color: var(--text-color);
            }

            .results-code {
                background: var(--input-bg);
                padding: 15px;
                border-radius: 6px;
                overflow-x: auto;
                font-family: 'Courier New', monospace;
                font-size: 13px;
                color: var(--text-color);
                max-height: 400px;
                overflow-y: auto;
            }

            /* Loading & Error States */
            .loading {
                text-align: center;
                padding: 40px;
                color: var(--text-muted);
            }

            .spinner {
                border: 3px solid var(--border-color);
                border-top: 3px solid var(--primary);
                border-radius: 50%;
                width: 40px;
                height: 40px;
                animation: spin 1s linear infinite;
                margin: 0 auto 20px;
            }

            @keyframes spin {
                0% {
                    transform: rotate(0deg);
                }
                100% {
                    transform: rotate(360deg);
                }
            }

            .alert {
                padding: 16px;
                border-radius: 6px;
                margin-bottom: 20px;
            }

            .alert-error {
                background: #fee2e2;
                color: #991b1b;
                border: 1px solid #fecaca;
            }

            .alert-success {
                background: #d1fae5;
                color: #065f46;
                border: 1px solid #a7f3d0;
            }

            .alert-info {
                background: #dbeafe;
                color: #1e40af;
                border: 1px solid #bfdbfe;
            }

            /* Server Components Demo */
            .rsc-server-component,
            .rsc-client-component {
                border-radius: 8px;
                padding: 20px;
                position: relative;
                margin-bottom: 10px;
            }

            .rsc-server-component {
                border: 2px solid #10b981;
            }

            .rsc-client-component {
                border: 2px solid #3b82f6;
            }

            .rsc-badge {
                display: inline-block;
                padding: 4px 10px;
                border-radius: 4px;
                font-size: 12px;
                font-weight: 600;
                margin-bottom: 12px;
            }

            .rsc-badge-server {
                background: #d1fae5;
                color: #065f46;
            }

            .rsc-badge-client {
                background: #dbeafe;
                color: #1e40af;
            }

            .rsc-concept-box {
                background: var(--section-bg);
                border: 1px solid var(--border-color);
                border-radius: 8px;
                padding: 20px;
            }

            .rsc-concept-card {
                padding: 15px;
                border-radius: 6px;
                font-size: 14px;
            }

            .rsc-concept-server {
                background: #d1fae5;
                color: #065f46;
                border: 1px solid #a7f3d0;
            }

            .rsc-concept-client {
                background: #dbeafe;
                color: #1e40af;
                border: 1px solid #bfdbfe;
            }

            .rsc-code-example {
                margin-top: 30px;
                padding: 20px;
                background: var(--section-bg);
                border-radius: 8px;
                border: 1px solid var(--border-color);
            }

            .rsc-code-example h3 {
                margin-bottom: 15px;
                color: var(--text-color);
            }

            /* Utility Classes */
            .mb-2 {
                margin-bottom: 20px;
            }
            .mt-2 {
                margin-top: 20px;
            }
        </style>
    </head>
    <body>
        <div id="root"></div>

        <script type="text/babel" data-presets="react,typescript">
            /* ===================================================================
           React PoC - Adblock Compiler Frontend

           ARCHITECTURE OVERVIEW:
           - Component-based architecture with functional components
           - React Hooks for state management (useState, useEffect)
           - React Router v6 for client-side navigation (see poc/react/REACT_ROUTER.md)
           - Context API for theme management (could use Redux/Zustand in production)
           - Controlled components for forms
           - Separation of concerns (presentation vs logic)

           KEY PATTERNS DEMONSTRATED:
           1. Component Decomposition: AppShell, Nav, ThemeToggle, CompilerForm, etc.
           2. State Management: useState for local state, Context for global theme
           3. Side Effects: useEffect for theme persistence
           4. Event Handling: Form submissions, input changes
           5. Conditional Rendering: Loading states, error states, results
           6. API Integration: Fetch API with async/await
           7. Client-Side Routing: BrowserRouter, Routes, Route, Link, useLocation
           8. React Server Components: RSC pattern simulation demonstrating server/client component split
              (not a real RSC implementation ‚Äî requires Next.js; see poc/react/REACT_SERVER_COMPONENTS.md)

           WHY REACT ROUTER?
           React Router intercepts link clicks and renders the correct component
           without a full browser reload, preserving in-memory state (form data,
           results) and providing instant transitions. It keeps the browser URL in
           sync so deep links, bookmarks, and the Back/Forward buttons all work
           as users expect. See poc/react/REACT_ROUTER.md for the full rationale.
           =================================================================== */

            const { useState, useEffect, createContext, useContext } = React;
            const { BrowserRouter, Routes, Route, Link, useLocation } = ReactRouterDOM;

            /* ===================================================================
           TYPE DEFINITIONS
           TypeScript interfaces for type safety across components
           =================================================================== */

            interface Stat {
                label: string;
                value: string;
            }

            interface TransformationMap {
                RemoveComments: boolean;
                Deduplicate: boolean;
                TrimLines: boolean;
                RemoveEmptyLines: boolean;
                Compress: boolean;
                RemoveModifiers: boolean;
                Validate: boolean;
                ValidateAllowIp: boolean;
                InvertAllow: boolean;
                InsertFinalNewLine: boolean;
                ConvertToAscii: boolean;
            }

            interface BenchmarkResult {
                duration: string;
                rulesPerSecond: number;
            }

            interface CompilationResult {
                success: boolean;
                ruleCount: number;
                sources: number;
                transformations: string[];
                message?: string;
                benchmark: BenchmarkResult;
            }

            interface ThemeContextType {
                theme: string;
                toggleTheme: () => void;
            }

            /* ===================================================================
           CONTEXT - Theme Management
           Pattern: Global state management using Context API
           In production, consider Redux, Zustand, or Jotai for complex state
           =================================================================== */
            const ThemeContext = createContext<ThemeContextType | undefined>(undefined);

            function ThemeProvider({ children }: { children: React.ReactNode }) {
                const [theme, setTheme] = useState<string>(() => {
                    return localStorage.getItem('theme') || 'light';
                });

                useEffect(() => {
                    document.documentElement.setAttribute('data-theme', theme);
                    localStorage.setItem('theme', theme);
                }, [theme]);

                const toggleTheme = () => {
                    setTheme((prev) => prev === 'light' ? 'dark' : 'light');
                };

                return (
                    <ThemeContext.Provider value={{ theme, toggleTheme }}>
                        {children}
                    </ThemeContext.Provider>
                );
            }

            function useTheme(): ThemeContextType {
                const context = useContext(ThemeContext);
                if (!context) {
                    throw new Error('useTheme must be used within a ThemeProvider');
                }
                return context;
            }

            /* ===================================================================
           COMPONENT - Theme Toggle Button
           Pattern: Controlled component with global state
           =================================================================== */
            function ThemeToggle() {
                const { theme, toggleTheme } = useTheme();

                return (
                    <button className='theme-toggle' onClick={toggleTheme}>
                        {theme === 'light' ? 'üåô Dark Mode' : '‚òÄÔ∏è Light Mode'}
                    </button>
                );
            }

            /* ===================================================================
           COMPONENT - Navigation
           Pattern: Declarative routing with React Router v6

           WHY REACT ROUTER HERE:
           - <Link> renders a normal <a> tag but intercepts the click, pushing a
             new history entry instead of reloading the page. This preserves all
             React state (form inputs, compiled results, theme) across navigations.
           - useLocation() gives reactive access to the current URL so the active
             link can be highlighted without any manual DOM queries or event listeners.
             React Router updates the component automatically on every navigation.
           =================================================================== */
            function Navigation() {
                const location = useLocation();

                const isActive = (path: string): boolean => location.pathname === path;

                return (
                    <nav className='nav'>
                        <ul className='nav-links'>
                            <li>
                                <Link
                                    to='/'
                                    className={`nav-link ${isActive('/') ? 'active' : ''}`}
                                >
                                    üè† Home
                                </Link>
                            </li>
                            <li>
                                <Link
                                    to='/compiler'
                                    className={`nav-link ${isActive('/compiler') ? 'active' : ''}`}
                                >
                                    ‚öôÔ∏è Compiler
                                </Link>
                            </li>
                            <li>
                                <Link
                                    to='/server-components'
                                    className={`nav-link ${isActive('/server-components') ? 'active' : ''}`}
                                >
                                    üñ•Ô∏è Server Components
                                </Link>
                            </li>
                        </ul>
                        <ThemeToggle />
                    </nav>
                );
            }

            /* ===================================================================
           COMPONENT - Home/Dashboard Page
           Pattern: Presentational component with static data
           In production, fetch real stats from API
           =================================================================== */
            function HomePage() {
                const stats: Stat[] = [
                    { label: 'Filter Lists Compiled', value: '1,234' },
                    { label: 'Total Rules Processed', value: '456K' },
                    { label: 'Active Transformations', value: '12' },
                    { label: 'Cache Hit Rate', value: '89%' },
                ];

                return (
                    <div>
                        <h1>Adblock Compiler Dashboard</h1>
                        <p className='mb-2' style={{ color: 'var(--text-muted)' }}>
                            Welcome to the Adblock Compiler. Compile and transform filter lists with ease.
                        </p>

                        <div className='stats-grid'>
                            {stats.map((stat, index) => (
                                <div key={index} className='stat-card'>
                                    <div className='stat-label'>{stat.label}</div>
                                    <div className='stat-value'>{stat.value}</div>
                                </div>
                            ))}
                        </div>

                        <div className='alert alert-info mt-2'>
                            <strong>‚ÑπÔ∏è React Pattern:</strong>{' '}
                            This page demonstrates component composition, map iteration for rendering lists, and responsive grid layouts.
                        </div>
                    </div>
                );
            }

            /* ===================================================================
           COMPONENT - Compiler Form
           Pattern: Complex form with multiple state values
           Demonstrates controlled components, array state management,
           and API integration with loading/error states
           =================================================================== */
            function CompilerPage() {
                // State Management - Multiple pieces of local state
                const [urls, setUrls] = useState<string[]>(['']);
                const [transformations, setTransformations] = useState<TransformationMap>({
                    RemoveComments: true,
                    Deduplicate: true,
                    TrimLines: false,
                    RemoveEmptyLines: false,
                    Compress: false,
                    RemoveModifiers: false,
                    Validate: false,
                    ValidateAllowIp: false,
                    InvertAllow: false,
                    InsertFinalNewLine: false,
                    ConvertToAscii: false,
                });
                const [loading, setLoading] = useState<boolean>(false);
                const [error, setError] = useState<string | null>(null);
                const [results, setResults] = useState<CompilationResult | null>(null);

                // URL Management Handlers
                const addUrl = (): void => {
                    setUrls([...urls, '']);
                };

                const updateUrl = (index: number, value: string): void => {
                    const newUrls = [...urls];
                    newUrls[index] = value;
                    setUrls(newUrls);
                };

                const removeUrl = (index: number): void => {
                    if (urls.length > 1) {
                        setUrls(urls.filter((_: string, i: number) => i !== index));
                    }
                };

                // Transformation Checkbox Handler
                const toggleTransformation = (name: keyof TransformationMap): void => {
                    setTransformations((prev: TransformationMap) => ({
                        ...prev,
                        [name]: !prev[name],
                    }));
                };

                // API Call Handler
                const handleCompile = async (e: React.FormEvent<HTMLFormElement>): Promise<void> => {
                    e.preventDefault();

                    // Validation
                    const validUrls = urls.filter((url) => url.trim() !== '');
                    if (validUrls.length === 0) {
                        setError('Please enter at least one URL');
                        return;
                    }

                    // Get selected transformations
                    const selectedTransformations = Object.entries(transformations)
                        .filter(([name, enabled]) => enabled)
                        .map(([name]) => name);

                    // Prepare request payload
                    const payload = {
                        configuration: {
                            name: 'React PoC Compilation',
                            sources: validUrls.map((url) => ({ source: url })),
                            transformations: selectedTransformations,
                        },
                        benchmark: true,
                    };

                    // API Call with loading/error handling
                    setLoading(true);
                    setError(null);
                    setResults(null);

                    try {
                        // In production, use actual API endpoint
                        const response = await fetch('/api/compile', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify(payload),
                        });

                        if (!response.ok) {
                            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                        }

                        const data = await response.json();
                        setResults(data);
                    } catch (err: unknown) {
                        // Mock success for demo purposes (API might not be available)
                        console.log('API call failed (expected in PoC), showing mock data:', err);
                        setResults({
                            success: true,
                            ruleCount: 1234,
                            sources: validUrls.length,
                            transformations: selectedTransformations,
                            message: 'Mock compilation result (API not available in PoC)',
                            benchmark: {
                                duration: '123ms',
                                rulesPerSecond: 10000,
                            },
                        });
                    } finally {
                        setLoading(false);
                    }
                };

                return (
                    <div>
                        <h1>Compiler</h1>
                        <p className='mb-2' style={{ color: 'var(--text-muted)' }}>
                            Configure and compile your filter lists
                        </p>

                        <form onSubmit={handleCompile}>
                            {/* URL Inputs Section */}
                            <div className='form-section'>
                                <h3>Filter List URLs</h3>
                                <div className='url-list'>
                                    {urls.map((url, index) => (
                                        <div key={index} className='url-input-row'>
                                            <input
                                                type='url'
                                                className='input'
                                                placeholder='https://example.com/filters.txt'
                                                value={url}
                                                onChange={(e) => updateUrl(index, e.target.value)}
                                            />
                                            {urls.length > 1 && (
                                                <button
                                                    type='button'
                                                    className='btn btn-danger'
                                                    onClick={() => removeUrl(index)}
                                                >
                                                    Remove
                                                </button>
                                            )}
                                        </div>
                                    ))}
                                </div>
                                <button
                                    type='button'
                                    className='btn btn-secondary'
                                    onClick={addUrl}
                                >
                                    + Add URL
                                </button>
                            </div>

                            {/* Transformations Section */}
                            <div className='form-section'>
                                <h3>Transformations</h3>
                                <div className='transformations-grid'>
                                    {(Object.entries(transformations) as [keyof TransformationMap, boolean][]).map(([name, checked]) => (
                                        <label key={name} className='checkbox-label'>
                                            <input
                                                type='checkbox'
                                                checked={checked}
                                                onChange={() => toggleTransformation(name)}
                                            />
                                            <span>{name}</span>
                                        </label>
                                    ))}
                                </div>
                            </div>

                            {/* Submit Button */}
                            <button
                                type='submit'
                                className='btn btn-primary'
                                disabled={loading}
                            >
                                {loading ? 'Compiling...' : 'üöÄ Compile'}
                            </button>
                        </form>

                        {/* Loading State */}
                        {loading && (
                            <div className='loading'>
                                <div className='spinner'></div>
                                <p>Compiling filter lists...</p>
                            </div>
                        )}

                        {/* Error State */}
                        {error && (
                            <div className='alert alert-error mt-2'>
                                <strong>‚ùå Error:</strong> {error}
                            </div>
                        )}

                        {/* Results Display */}
                        {results && (
                            <div className='results-container'>
                                <h3>‚úÖ Compilation Results</h3>
                                <div className='results-code'>
                                    <pre>{JSON.stringify(results, null, 2)}</pre>
                                </div>
                            </div>
                        )}

                        <div className='alert alert-info mt-2'>
                            <strong>‚ÑπÔ∏è React Pattern:</strong>{' '}
                            This form demonstrates controlled components, complex state management with multiple useState hooks, async API calls, and conditional
                            rendering based on loading/error/success states.
                        </div>
                    </div>
                );
            }

            /* ===================================================================
           PAGE - Server Components Demo
           Pattern: React Server Components (RSC) simulation

           NOTE: True React Server Components require a framework like Next.js 14+
           (App Router). This page SIMULATES the RSC pattern to demonstrate the
           architecture and show why RSC would benefit the Adblock Compiler.
           See poc/react/REACT_SERVER_COMPONENTS.md for the full rationale.

           WHAT THIS PAGE DEMONSTRATES:
           1. Server Components: async, no hooks/events, fetch data directly
           2. Client Components: 'use client' directive, hooks and event handlers
           3. Composition: server components pass data as props to client components
           4. Streaming: data arrives after a simulated server delay
           =================================================================== */

            interface ServerStats {
                totalRules: number;
                activeSources: number;
                lastCompiled: string;
                transformations: string[];
                cacheSize: string;
            }

            // Simulates a server-side data fetch.
            // In a real Next.js RSC this would be a top-level `await` inside an
            // async Server Component ‚Äî no useEffect, no useState.
            function fetchServerStats(): Promise<ServerStats> {
                return new Promise((resolve) => {
                    setTimeout(() => {
                        resolve({
                            totalRules: 847293,
                            activeSources: 42,
                            lastCompiled: new Date().toISOString(),
                            transformations: ['RemoveComments', 'Deduplicate', 'TrimLines'],
                            cacheSize: '12.4 MB',
                        });
                    }, 1200);
                });
            }

            /* ===================================================================
           SIMULATED SERVER COMPONENT - StatsPanel
           In Next.js 14 (App Router) this would be an async function with no
           'use client' directive. It would await data directly and ship zero
           JavaScript to the browser ‚Äî only the rendered HTML is sent.

           Constraints enforced here to match a real Server Component:
             ‚úÖ No useState / useEffect
             ‚úÖ No event handlers (onClick, onChange, etc.)
             ‚úÖ Receives data as props (as if pre-fetched on the server)
           =================================================================== */
            function StatsPanel({ stats }: { stats: ServerStats }) {
                return (
                    <div className='rsc-server-component'>
                        <div className='rsc-badge rsc-badge-server'>üñ•Ô∏è Server Component</div>
                        <h3>Live Compilation Stats</h3>
                        <p style={{ color: 'var(--text-muted)', fontSize: '13px', marginBottom: '15px' }}>
                            In production (Next.js), this data is fetched <em>server-side</em> ‚Äî no client JavaScript required, no loading flash.
                        </p>
                        <div className='stats-grid'>
                            <div className='stat-card'>
                                <div className='stat-label'>Total Rules</div>
                                <div className='stat-value'>{stats.totalRules.toLocaleString()}</div>
                            </div>
                            <div className='stat-card'>
                                <div className='stat-label'>Active Sources</div>
                                <div className='stat-value'>{stats.activeSources}</div>
                            </div>
                            <div className='stat-card'>
                                <div className='stat-label'>Cache Size</div>
                                <div className='stat-value'>{stats.cacheSize}</div>
                            </div>
                        </div>
                        <p style={{ marginTop: '15px', fontSize: '13px', color: 'var(--text-muted)' }}>
                            Last compiled: {new Date(stats.lastCompiled).toLocaleString()}
                        </p>
                    </div>
                );
            }

            /* ===================================================================
           SIMULATED CLIENT COMPONENT - TransformationPicker
           In Next.js 14 this file would begin with 'use client'.
           Client Components retain full Hook and event-handler support.
           They receive server-fetched data as props from the Server Component.

           Constraints that justify 'use client':
             ‚úÖ Uses useState (interactive toggle)
             ‚úÖ Uses onClick event handler
             ‚úÖ Receives initial data as props from StatsPanel's parent
           =================================================================== */
            function TransformationPicker({ initialList }: { initialList: string[] }) {
                // In Next.js this would have 'use client' directive ‚Äî this component uses state and event handlers
                const [selected, setSelected] = useState<string[]>(initialList);
                const [saved, setSaved] = useState<boolean>(false);

                const allTransformations: string[] = [
                    'RemoveComments', 'Deduplicate', 'TrimLines',
                    'RemoveEmptyLines', 'Compress', 'Validate',
                ];

                const toggle = (name: string): void => {
                    setSaved(false);
                    setSelected((prev: string[]) =>
                        prev.includes(name) ? prev.filter((t: string) => t !== name) : [...prev, name],
                    );
                };

                const handleSave = (): void => {
                    setSaved(true);
                    setTimeout(() => setSaved(false), 2000);
                };

                return (
                    <div className='rsc-client-component'>
                        <div className='rsc-badge rsc-badge-client'>‚ö° Client Component</div>
                        <h3>Transformation Picker</h3>
                        <p style={{ color: 'var(--text-muted)', fontSize: '13px', marginBottom: '15px' }}>
                            This component uses <code>useState</code> for interactivity ‚Äî it must be a Client Component.
                            It receives its initial list as a prop from the Server Component above.
                        </p>
                        <div className='transformations-grid'>
                            {allTransformations.map((name: string) => (
                                <label key={name} className='checkbox-label'>
                                    <input
                                        type='checkbox'
                                        checked={selected.includes(name)}
                                        onChange={() => toggle(name)}
                                    />
                                    <span>{name}</span>
                                </label>
                            ))}
                        </div>
                        <button
                            className='btn btn-primary'
                            style={{ marginTop: '15px' }}
                            onClick={handleSave}
                        >
                            {saved ? '‚úÖ Saved!' : 'üíæ Save Preferences'}
                        </button>
                    </div>
                );
            }

            /* ===================================================================
           PAGE - Server Components Demo
           Composes StatsPanel (server) and TransformationPicker (client).
           The useEffect here simulates what Next.js does automatically when
           an async Server Component awaits data before streaming its HTML.
           =================================================================== */
            function ServerComponentsPage() {
                const [stats, setStats] = useState<ServerStats | null>(null);
                const [loading, setLoading] = useState<boolean>(true);

                useEffect(() => {
                    fetchServerStats().then((data: ServerStats) => {
                        setStats(data);
                        setLoading(false);
                    });
                }, []);

                return (
                    <div>
                        <h1>React Server Components</h1>
                        <p className='mb-2' style={{ color: 'var(--text-muted)' }}>
                            Demonstrating the RSC architecture pattern and why it benefits the Adblock Compiler.
                            See <strong>poc/react/REACT_SERVER_COMPONENTS.md</strong> for the full rationale.
                        </p>

                        {/* Concept explanation */}
                        <div className='rsc-concept-box'>
                            <h3>üèóÔ∏è How RSC Works</h3>
                            <p>React Server Components split the component tree into two rendering environments:</p>
                            <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '15px', marginTop: '15px' }}>
                                <div className='rsc-concept-card rsc-concept-server'>
                                    <strong>üñ•Ô∏è Server Components</strong>
                                    <ul style={{ marginTop: '8px', paddingLeft: '20px', fontSize: '13px' }}>
                                        <li>Render on the server</li>
                                        <li><code>async</code> by default ‚Äî <code>await</code> data directly</li>
                                        <li>Zero JS shipped to the browser</li>
                                        <li>Can access databases and secrets</li>
                                        <li>No useState / useEffect</li>
                                    </ul>
                                </div>
                                <div className='rsc-concept-card rsc-concept-client'>
                                    <strong>‚ö° Client Components</strong>
                                    <ul style={{ marginTop: '8px', paddingLeft: '20px', fontSize: '13px' }}>
                                        <li>Render in the browser</li>
                                        <li>Full React Hook support</li>
                                        <li>Event handlers and interactivity</li>
                                        <li>Browser API access</li>
                                        <li>Marked with <code>'use client'</code></li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        {/* Live demo */}
                        <div style={{ marginTop: '30px' }}>
                            <h2 style={{ marginBottom: '20px' }}>üì° Live Demo (Simulated)</h2>
                            {loading ? (
                                <div className='loading'>
                                    <div className='spinner'></div>
                                    <p>Server component fetching data...</p>
                                </div>
                            ) : stats ? (
                                <>
                                    <StatsPanel stats={stats} />
                                    <div style={{ marginTop: '20px' }}>
                                        <TransformationPicker initialList={stats.transformations} />
                                    </div>
                                </>
                            ) : null}
                        </div>

                        {/* Code example */}
                        <div className='rsc-code-example'>
                            <h3>üìù Real RSC Code (Next.js 14 App Router)</h3>
                            <pre className='results-code'>{`// app/dashboard/page.tsx ‚Äî Server Component (no 'use client')
import { TransformationPicker } from './TransformationPicker';

async function DashboardPage() {
    // Runs on the server ‚Äî can await DB/API calls directly
    const stats = await fetchCompilerStats();
    return (
        <main>
            <StatsPanel stats={stats} />
            {/* Pass server data as props to the interactive Client Component */}
            <TransformationPicker initialList={stats.transformations} />
        </main>
    );
}

// components/TransformationPicker.tsx ‚Äî Client Component
'use client';

import { useState } from 'react';

function TransformationPicker({ initialList }) {
    const [selected, setSelected] = useState(initialList);
    // ... interactive logic with useState and event handlers
}`}</pre>
                        </div>

                        <div className='alert alert-info mt-2'>
                            <strong>‚ÑπÔ∏è React Pattern:</strong>{' '}
                            This page simulates RSC behaviour using <code>useEffect</code> (a Client Component approach).
                            In a real Next.js 14 application, <code>StatsPanel</code> would be a genuine Server
                            Component ‚Äî an <code>async</code> function that <code>await</code>s data and ships{' '}
                            <strong>zero JavaScript</strong> to the client.
                            See <strong>poc/react/REACT_SERVER_COMPONENTS.md</strong> for detailed integration guidance.
                        </div>
                    </div>
                );
            }

            /* ===================================================================
           COMPONENT - App Shell
           Pattern: Layout component with client-side routing

           WHY REACT ROUTER HERE:
           - <Routes> + <Route> declare all pages in one readable place. Adding a
             new page is a one-line change; no event listeners or switch statements.
           - Only the inner <Routes> re-renders on navigation; the surrounding
             <Navigation /> never unmounts, so its state (e.g., scroll position)
             is preserved. This is equivalent to a nested-route layout pattern.
           =================================================================== */
            function AppShell() {
                return (
                    <div className='app-container'>
                        <Navigation />
                        <main className='main-content'>
                            <Routes>
                                <Route path='/' element={<HomePage />} />
                                <Route path='/compiler' element={<CompilerPage />} />
                                <Route path='/server-components' element={<ServerComponentsPage />} />
                            </Routes>
                        </main>
                    </div>
                );
            }

            /* ===================================================================
           ROOT COMPONENT - Application Entry Point
           Pattern: Provider wrapping for global state and routing

           WHY BROWSERROUTER AT THE ROOT:
           - <BrowserRouter> must wrap the entire application so that all
             components (Navigation, AppShell, etc.) share the same router context.
           - It uses the HTML5 History API (pushState/replaceState) to manage the
             URL, providing clean URLs like /compiler instead of hash-based /#/compiler.
           =================================================================== */
            function App() {
                return (
                    <BrowserRouter>
                        <ThemeProvider>
                            <AppShell />
                        </ThemeProvider>
                    </BrowserRouter>
                );
            }

            /* ===================================================================
           BOOTSTRAP - Render React App
           =================================================================== */
            const root = ReactDOM.createRoot(document.getElementById('root'));
            root.render(<App />);
        </script>
    </body>
</html>
