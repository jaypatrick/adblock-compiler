<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Vue PoC - Adblock Compiler</title>

        <!-- Vue 3 via CDN -->
        <script src="https://unpkg.com/vue@3.4.15/dist/vue.global.js"></script>
        <!-- Vue Router 4 via CDN -->
        <script src="https://unpkg.com/vue-router@4.2.5/dist/vue-router.global.js"></script>

        <style>
            /* =================================================================
               CSS Variables - Theming System
               Vue Pattern: CSS custom properties for theme management
               ================================================================= */
            :root {
                /* Brand Colors */
                --bg-gradient-start: #667eea;
                --bg-gradient-end: #764ba2;
                --primary: #667eea;
                --primary-dark: #5568d3;
                --secondary: #764ba2;

                /* Light Theme (Default) */
                --container-bg: #ffffff;
                --text-color: #333333;
                --text-muted: #666666;
                --border-color: #e0e0e0;
                --input-bg: #ffffff;
                --section-bg: #f8f9fa;
                --card-bg: #ffffff;
                --button-hover: #f5f5f5;

                /* Status Colors */
                --success: #10b981;
                --danger: #ef4444;
                --warning: #f59e0b;
                --info: #3b82f6;
            }

            /* Dark Theme */
            [data-theme='dark'] {
                --bg-gradient-start: #1a1a2e;
                --bg-gradient-end: #16213e;
                --container-bg: #1e1e2e;
                --text-color: #e0e0e0;
                --text-muted: #a0a0a0;
                --border-color: #3a3a4a;
                --input-bg: #2a2a3a;
                --section-bg: #252535;
                --card-bg: #2a2a3a;
                --button-hover: #3a3a4a;
            }

            /* =================================================================
               Base Styles
               ================================================================= */
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }

            body {
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
                background: linear-gradient(135deg, var(--bg-gradient-start) 0%, var(--bg-gradient-end) 100%);
                min-height: 100vh;
                color: var(--text-color);
                transition: background 0.3s ease;
            }

            /* =================================================================
               Layout Components
               ================================================================= */
            .app-container {
                max-width: 1200px;
                margin: 0 auto;
                padding: 20px;
            }

            /* Navigation */
            .nav {
                background: var(--container-bg);
                border-radius: 12px;
                padding: 20px;
                margin-bottom: 20px;
                box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
                display: flex;
                justify-content: space-between;
                align-items: center;
            }

            .nav-links {
                display: flex;
                gap: 20px;
                list-style: none;
            }

            .nav-link {
                color: var(--text-muted);
                text-decoration: none;
                padding: 8px 16px;
                border-radius: 6px;
                transition: all 0.3s ease;
                font-weight: 500;
            }

            .nav-link:hover {
                background: var(--button-hover);
                color: var(--primary);
            }

            .nav-link.router-link-active {
                background: var(--primary);
                color: white;
            }

            /* Theme Toggle */
            .theme-toggle {
                background: var(--section-bg);
                border: 1px solid var(--border-color);
                color: var(--text-color);
                padding: 8px 16px;
                border-radius: 6px;
                cursor: pointer;
                font-size: 14px;
                transition: all 0.3s ease;
            }

            .theme-toggle:hover {
                background: var(--button-hover);
                transform: translateY(-2px);
            }

            /* Main Content */
            .main-content {
                background: var(--container-bg);
                border-radius: 12px;
                padding: 30px;
                box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
                min-height: 400px;
            }

            /* =================================================================
               Component Styles
               ================================================================= */

            /* Stats Cards (Home Page) */
            .stats-grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
                gap: 20px;
                margin: 30px 0;
            }

            .stat-card {
                background: var(--section-bg);
                padding: 24px;
                border-radius: 8px;
                border: 1px solid var(--border-color);
                transition: transform 0.3s ease, box-shadow 0.3s ease;
            }

            .stat-card:hover {
                transform: translateY(-4px);
                box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
            }

            .stat-label {
                color: var(--text-muted);
                font-size: 14px;
                margin-bottom: 8px;
            }

            .stat-value {
                font-size: 32px;
                font-weight: 700;
                color: var(--primary);
            }

            /* Compiler Form */
            .form-section {
                margin-bottom: 30px;
            }

            .form-section h3 {
                margin-bottom: 15px;
                color: var(--text-color);
            }

            .url-list {
                display: flex;
                flex-direction: column;
                gap: 10px;
                margin-bottom: 15px;
            }

            .url-input-row {
                display: flex;
                gap: 10px;
            }

            .input {
                flex: 1;
                padding: 12px;
                border: 1px solid var(--border-color);
                border-radius: 6px;
                background: var(--input-bg);
                color: var(--text-color);
                font-size: 14px;
                transition: border-color 0.3s ease;
            }

            .input:focus {
                outline: none;
                border-color: var(--primary);
            }

            .btn {
                padding: 12px 24px;
                border: none;
                border-radius: 6px;
                font-size: 14px;
                font-weight: 600;
                cursor: pointer;
                transition: all 0.3s ease;
            }

            .btn-primary {
                background: var(--primary);
                color: white;
            }

            .btn-primary:hover:not(:disabled) {
                background: var(--primary-dark);
                transform: translateY(-2px);
                box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            }

            .btn-secondary {
                background: var(--section-bg);
                color: var(--text-color);
                border: 1px solid var(--border-color);
            }

            .btn-secondary:hover {
                background: var(--button-hover);
            }

            .btn-danger {
                background: var(--danger);
                color: white;
            }

            .btn-danger:hover {
                opacity: 0.9;
            }

            .btn:disabled {
                opacity: 0.5;
                cursor: not-allowed;
            }

            /* Transformations Checkboxes */
            .transformations-grid {
                display: grid;
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
                gap: 12px;
                margin-top: 15px;
            }

            .checkbox-label {
                display: flex;
                align-items: center;
                gap: 8px;
                padding: 10px;
                background: var(--section-bg);
                border-radius: 6px;
                cursor: pointer;
                transition: background 0.3s ease;
            }

            .checkbox-label:hover {
                background: var(--button-hover);
            }

            .checkbox-label input[type='checkbox'] {
                width: 18px;
                height: 18px;
                cursor: pointer;
            }

            /* Results Display */
            .results-container {
                margin-top: 30px;
                padding: 20px;
                background: var(--section-bg);
                border-radius: 8px;
                border: 1px solid var(--border-color);
            }

            .results-container h3 {
                margin-bottom: 15px;
                color: var(--text-color);
            }

            .results-code {
                background: var(--input-bg);
                padding: 15px;
                border-radius: 6px;
                overflow-x: auto;
                font-family: 'Courier New', monospace;
                font-size: 13px;
                color: var(--text-color);
                max-height: 400px;
                overflow-y: auto;
            }

            /* Loading & Error States */
            .loading {
                text-align: center;
                padding: 40px;
                color: var(--text-muted);
            }

            .spinner {
                border: 3px solid var(--border-color);
                border-top: 3px solid var(--primary);
                border-radius: 50%;
                width: 40px;
                height: 40px;
                animation: spin 1s linear infinite;
                margin: 0 auto 20px;
            }

            @keyframes spin {
                0% {
                    transform: rotate(0deg);
                }
                100% {
                    transform: rotate(360deg);
                }
            }

            .alert {
                padding: 16px;
                border-radius: 6px;
                margin-bottom: 20px;
            }

            .alert-error {
                background: #fee2e2;
                color: #991b1b;
                border: 1px solid #fecaca;
            }

            .alert-success {
                background: #d1fae5;
                color: #065f46;
                border: 1px solid #a7f3d0;
            }

            .alert-info {
                background: #dbeafe;
                color: #1e40af;
                border: 1px solid #bfdbfe;
            }

            /* Utility Classes */
            .mb-2 {
                margin-bottom: 20px;
            }
            .mt-2 {
                margin-top: 20px;
            }

            /* About Page - Vue Router Feature Grid */
            .feature-grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
                gap: 16px;
                margin: 20px 0;
            }

            .feature-card {
                background: var(--section-bg);
                border: 1px solid var(--border-color);
                border-radius: 8px;
                padding: 20px;
            }

            .feature-card h4 {
                color: var(--primary);
                margin-bottom: 8px;
                font-size: 15px;
            }

            .feature-card p {
                color: var(--text-muted);
                font-size: 13px;
                line-height: 1.6;
            }

            /* Route Info Box */
            .route-info {
                background: var(--section-bg);
                border: 1px solid var(--border-color);
                border-radius: 8px;
                padding: 16px;
                margin: 20px 0;
                font-family: 'Courier New', monospace;
                font-size: 13px;
            }

            .route-info div {
                margin-bottom: 6px;
                color: var(--text-muted);
            }

            .route-info span {
                color: var(--primary);
                font-weight: 600;
            }

            /* Preset Buttons */
            .preset-grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 12px;
                margin: 20px 0;
            }

            .preset-card {
                background: var(--section-bg);
                border: 1px solid var(--border-color);
                border-radius: 8px;
                padding: 16px;
                cursor: pointer;
                transition: all 0.3s ease;
                text-align: left;
            }

            .preset-card:hover {
                border-color: var(--primary);
                transform: translateY(-2px);
                box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
            }

            .preset-card h4 {
                color: var(--text-color);
                margin-bottom: 6px;
                font-size: 14px;
            }

            .preset-card p {
                color: var(--text-muted);
                font-size: 12px;
            }

            /* Active preset indicator */
            .preset-badge {
                display: inline-block;
                padding: 4px 12px;
                background: var(--primary);
                color: white;
                border-radius: 20px;
                font-size: 12px;
                margin-bottom: 16px;
            }
        </style>
    </head>
    <body>
        <div id="app"></div>

        <script>
            // @ts-check
            /* ===================================================================
           Vue PoC - Adblock Compiler Frontend

           ARCHITECTURE OVERVIEW:
           - Component-based architecture with Vue 3 Composition API
           - Reactive state management with ref() and reactive()
           - Vue Router for declarative routing
           - Computed properties for derived state
           - Lifecycle hooks (onMounted, watch) for side effects
           - Two-way data binding with v-model
           - Template-based declarative rendering

           KEY PATTERNS DEMONSTRATED:
           1. Composition API: setup(), ref(), reactive(), computed()
           2. Template Directives: v-for, v-if, v-model, v-on, :class
           3. Component Composition: Reusable components with props/emits
           4. Reactivity System: Automatic UI updates when state changes
           5. Router Integration: Declarative routing with <router-view>
           6. Event Handling: @click, @submit, @input
           =================================================================== */

            /* ===================================================================
           TYPE DEFINITIONS
           JSDoc type annotations for type safety across components
           (VS Code and other editors use these for code completion and checking)
           =================================================================== */

            /**
             * @typedef {{ label: string, value: string }} Stat
             */

            /**
             * @typedef {{ RemoveComments: boolean, Deduplicate: boolean, TrimLines: boolean, RemoveEmptyLines: boolean, Compress: boolean, RemoveModifiers: boolean, Validate: boolean, ValidateAllowIp: boolean, InvertAllow: boolean, InsertFinalNewLine: boolean, ConvertToAscii: boolean }} TransformationMap
             */

            /**
             * @typedef {{ duration: string, rulesPerSecond: number }} BenchmarkResult
             */

            /**
             * @typedef {{ success: boolean, ruleCount: number, sources: number, transformations: string[], message?: string, benchmark: BenchmarkResult }} CompilationResult
             */

            const { createApp, ref, reactive, computed, onMounted, watch } = Vue;
            const { createRouter, createWebHashHistory, useRoute, useRouter } = VueRouter;

            /* ===================================================================
           PRESET CONFIGURATIONS
           Vue Pattern: Shared constant for reusable data
           Centralizes preset definitions used across HomePage and CompilerPage
           =================================================================== */
            const PRESET_CONFIGS = {
                dns: {
                    id: 'dns',
                    icon: 'üõ°Ô∏è',
                    name: 'DNS Safe',
                    description: 'Remove comments, deduplicate, validate for DNS-level blocking.',
                    transformations: {
                        RemoveComments: true,
                        Deduplicate: true,
                        Validate: true,
                    },
                },
                clean: {
                    id: 'clean',
                    icon: 'üßπ',
                    name: 'Clean & Trim',
                    description: 'Remove comments, trim lines, and remove empty lines.',
                    transformations: {
                        RemoveComments: true,
                        TrimLines: true,
                        RemoveEmptyLines: true,
                    },
                },
                minimal: {
                    id: 'minimal',
                    icon: '‚ö°',
                    name: 'Minimal',
                    description: 'Deduplicate and insert a final newline only.',
                    transformations: {
                        Deduplicate: true,
                        InsertFinalNewLine: true,
                    },
                },
            };

            /* ===================================================================
           COMPOSABLE - Theme Management
           Vue Pattern: Composition API composable for reusable logic
           Similar to React custom hooks
           =================================================================== */
            /**
             * @returns {{ theme: import('vue').Ref<string>, toggleTheme: () => void }}
             */
            function useTheme() {
                /** @type {import('vue').Ref<string>} */
                const theme = ref(localStorage.getItem('theme') || 'light');

                const toggleTheme = () => {
                    theme.value = theme.value === 'light' ? 'dark' : 'light';
                };

                // Watch for theme changes and persist
                watch(theme, (newTheme) => {
                    document.documentElement.setAttribute('data-theme', newTheme);
                    localStorage.setItem('theme', newTheme);
                }, { immediate: true });

                return {
                    theme,
                    toggleTheme,
                };
            }

            /* ===================================================================
           COMPONENT - Theme Toggle
           Vue Pattern: Simple component using Composition API
           =================================================================== */
            const ThemeToggle = {
                template: `
                <button class="theme-toggle" @click="toggleTheme">
                    {{ theme === 'light' ? 'üåô Dark Mode' : '‚òÄÔ∏è Light Mode' }}
                </button>
            `,
                setup() {
                    const { theme, toggleTheme } = useTheme();
                    return { theme, toggleTheme };
                },
            };

            /* ===================================================================
           COMPONENT - Navigation
           Vue Pattern: Router-aware navigation with router-link
           Uses scoped slots and dynamic classes
           =================================================================== */
            const Navigation = {
                template: `
                <nav class="nav">
                    <ul class="nav-links">
                        <li>
                            <router-link to="/" class="nav-link">
                                üè† Home
                            </router-link>
                        </li>
                        <li>
                            <router-link to="/compiler" class="nav-link">
                                ‚öôÔ∏è Compiler
                            </router-link>
                        </li>
                        <li>
                            <router-link to="/about" class="nav-link">
                                ‚ÑπÔ∏è About Vue Router
                            </router-link>
                        </li>
                    </ul>
                    <theme-toggle />
                </nav>
            `,
                components: {
                    ThemeToggle,
                },
            };

            /* ===================================================================
           COMPONENT - Home/Dashboard Page
           Vue Pattern: Template-driven rendering with v-for directive
           Demonstrates declarative list rendering
           =================================================================== */
            const HomePage = {
                template: `
                <div>
                    <h1>Adblock Compiler Dashboard</h1>
                    <p class="mb-2" style="color: var(--text-muted)">
                        Welcome to the Adblock Compiler. Compile and transform filter lists with ease.
                    </p>
                    
                    <div class="stats-grid">
                        <div 
                            v-for="(stat, index) in stats" 
                            :key="index" 
                            class="stat-card"
                        >
                            <div class="stat-label">{{ stat.label }}</div>
                            <div class="stat-value">{{ stat.value }}</div>
                        </div>
                    </div>

                    <!-- Quick Start with Presets - demonstrates programmatic navigation -->
                    <h2 style="margin: 24px 0 8px;">Quick Start with a Preset</h2>
                    <p style="color: var(--text-muted); margin-bottom: 16px; font-size: 14px;">
                        Click a preset to open the Compiler with transformations pre-selected.
                        Uses <code>router.push('/compiler/:preset')</code> ‚Äî programmatic navigation.
                    </p>
                    <div class="preset-grid">
                        <div 
                            v-for="preset in presets" 
                            :key="preset.id" 
                            class="preset-card" 
                            @click="launchPreset(preset.id)"
                        >
                            <h4>{{ preset.icon }} {{ preset.name }}</h4>
                            <p>{{ preset.description }}</p>
                        </div>
                    </div>
                    
                    <div class="alert alert-info mt-2">
                        <strong>‚ÑπÔ∏è Vue Router Pattern:</strong> The preset cards above call
                        <code>router.push(\`/compiler/\${presetId}\`)</code>. The Compiler page reads
                        <code>route.params.preset</code> and pre-selects the appropriate transformations ‚Äî
                        demonstrating how route parameters enable shareable, bookmarkable application states.
                    </div>
                </div>
            `,
                setup() {
                    const router = useRouter();

                    /** @type {import('vue').Ref<Stat[]>} */
                    const stats = ref([
                        { label: 'Filter Lists Compiled', value: '1,234' },
                        { label: 'Total Rules Processed', value: '456K' },
                        { label: 'Active Transformations', value: '12' },
                        { label: 'Cache Hit Rate', value: '89%' },
                    ]);

                    const presets = ref([
                        PRESET_CONFIGS.dns,
                        PRESET_CONFIGS.clean,
                        PRESET_CONFIGS.minimal,
                    ]);

                    // Programmatic navigation with route parameter
                    const launchPreset = (presetId) => {
                        router.push(`/compiler/${presetId}`);
                    };

                    return { stats, presets, launchPreset };
                },
            };

            /* ===================================================================
           COMPONENT - Compiler Form
           Vue Pattern: Complex form with reactive state and v-model binding
           Demonstrates two-way data binding, computed properties, async methods,
           and reading URL route parameters with useRoute()
           =================================================================== */
            const CompilerPage = {
                template: `
                <div>
                    <h1>Compiler</h1>
                    <p class="mb-2" style="color: var(--text-muted)">
                        Configure and compile your filter lists
                    </p>

                    <!-- Active Preset Badge - shown when loaded via route param -->
                    <div v-if="activePreset" class="preset-badge">
                        üéØ Preset loaded: {{ activePreset }}
                    </div>
                    
                    <form @submit.prevent="handleCompile">
                        <!-- URL Inputs Section -->
                        <div class="form-section">
                            <h3>Filter List URLs</h3>
                            <div class="url-list">
                                <div 
                                    v-for="(url, index) in urls" 
                                    :key="index" 
                                    class="url-input-row"
                                >
                                    <input
                                        v-model="urls[index]"
                                        type="url"
                                        class="input"
                                        placeholder="https://example.com/filters.txt"
                                    />
                                    <button
                                        v-if="urls.length > 1"
                                        type="button"
                                        class="btn btn-danger"
                                        @click="removeUrl(index)"
                                    >
                                        Remove
                                    </button>
                                </div>
                            </div>
                            <button
                                type="button"
                                class="btn btn-secondary"
                                @click="addUrl"
                            >
                                + Add URL
                            </button>
                        </div>
                        
                        <!-- Transformations Section -->
                        <div class="form-section">
                            <h3>Transformations</h3>
                            <div class="transformations-grid">
                                <label 
                                    v-for="name in transformationNames" 
                                    :key="name" 
                                    class="checkbox-label"
                                >
                                    <input
                                        v-model="transformations[name]"
                                        type="checkbox"
                                    />
                                    <span>{{ name }}</span>
                                </label>
                            </div>
                        </div>
                        
                        <!-- Submit Button -->
                        <button
                            type="submit"
                            class="btn btn-primary"
                            :disabled="loading"
                        >
                            {{ loading ? 'Compiling...' : 'üöÄ Compile' }}
                        </button>
                    </form>
                    
                    <!-- Loading State -->
                    <div v-if="loading" class="loading">
                        <div class="spinner"></div>
                        <p>Compiling filter lists...</p>
                    </div>
                    
                    <!-- Error State -->
                    <div v-if="error" class="alert alert-error mt-2">
                        <strong>‚ùå Error:</strong> {{ error }}
                    </div>
                    
                    <!-- Results Display -->
                    <div v-if="results" class="results-container">
                        <h3>‚úÖ Compilation Results</h3>
                        <div class="results-code">
                            <pre>{{ JSON.stringify(results, null, 2) }}</pre>
                        </div>
                    </div>
                    
                    <div class="alert alert-info mt-2">
                        <strong>‚ÑπÔ∏è Vue Router Pattern:</strong> When this page is opened via a preset link
                        (e.g. <code>#/compiler/dns</code>), <code>useRoute().params.preset</code> is read
                        in <code>onMounted</code> to pre-select the matching transformations. This makes the
                        URL a shareable, bookmarkable representation of application state.
                    </div>
                </div>
            `,
                setup() {
                    const route = useRoute();

                    // Reactive State - Vue's reactivity system
                    /** @type {import('vue').Ref<string[]>} */
                    const urls = ref(['']);
                    /** @type {TransformationMap} */
                    const transformations = reactive({
                        RemoveComments: true,
                        Deduplicate: true,
                        TrimLines: false,
                        RemoveEmptyLines: false,
                        Compress: false,
                        RemoveModifiers: false,
                        Validate: false,
                        ValidateAllowIp: false,
                        InvertAllow: false,
                        InsertFinalNewLine: false,
                        ConvertToAscii: false,
                    });
                    /** @type {import('vue').Ref<boolean>} */
                    const loading = ref(false);
                    /** @type {import('vue').Ref<string | null>} */
                    const error = ref(null);
                    /** @type {import('vue').Ref<CompilationResult | null>} */
                    const results = ref(null);

                    // Read preset name from route params (useRoute)
                    const activePreset = computed(() => route.params.preset || null);

                    // Apply preset transformations when route param changes
                    const applyPreset = (presetId) => {
                        // Reset all transformations first
                        Object.keys(transformations).forEach((key) => (transformations[key] = false));
                        
                        // If preset exists in config, apply its transformations
                        if (presetId && PRESET_CONFIGS[presetId]) {
                            const presetTransformations = PRESET_CONFIGS[presetId].transformations;
                            Object.entries(presetTransformations).forEach(([key, value]) => {
                                if (key in transformations) {
                                    transformations[key] = value;
                                }
                            });
                        } else if (presetId) {
                            // Unknown preset - log warning for debugging (PoC demo feature)
                            console.warn(`[Vue Router] Unknown preset "${presetId}" (available: ${Object.keys(PRESET_CONFIGS).join(', ')}). Applying default transformations.`);
                            // Apply default transformations as fallback
                            transformations.RemoveComments = true;
                            transformations.Deduplicate = true;
                        }
                        // If no presetId, leave all transformations disabled
                    };

                    // Apply preset on mount and whenever the route param changes
                    onMounted(() => {
                        if (route.params.preset) {
                            applyPreset(route.params.preset);
                        }
                    });

                    watch(() => route.params.preset, (newPreset) => {
                        applyPreset(newPreset);
                    });

                    // Computed property for transformation names
                    const transformationNames = computed(() => Object.keys(transformations));

                    // Methods
                    /** @returns {void} */
                    const addUrl = () => {
                        urls.value.push('');
                    };

                    /** @param {number} index @returns {void} */
                    const removeUrl = (index) => {
                        if (urls.value.length > 1) {
                            urls.value.splice(index, 1);
                        }
                    };

                    /** @returns {Promise<void>} */
                    const handleCompile = async () => {
                        const validUrls = urls.value.filter((url) => url.trim() !== '');
                        if (validUrls.length === 0) {
                            error.value = 'Please enter at least one URL';
                            return;
                        }

                        const selectedTransformations = Object.entries(transformations)
                            .filter(([, enabled]) => enabled)
                            .map(([name]) => name);

                        const payload = {
                            configuration: {
                                name: 'Vue PoC Compilation',
                                sources: validUrls.map((url) => ({ source: url })),
                                transformations: selectedTransformations,
                            },
                            benchmark: true,
                        };

                        loading.value = true;
                        error.value = null;
                        results.value = null;

                        try {
                            const response = await fetch('/api/compile', {
                                method: 'POST',
                                headers: { 'Content-Type': 'application/json' },
                                body: JSON.stringify(payload),
                            });

                            if (!response.ok) {
                                throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                            }

                            results.value = await response.json();
                        } catch (err) {
                            console.log('API call failed (expected in PoC), showing mock data:', err);
                            results.value = {
                                success: true,
                                ruleCount: 1234,
                                sources: validUrls.length,
                                transformations: selectedTransformations,
                                message: 'Mock compilation result (API not available in PoC)',
                                benchmark: { duration: '123ms', rulesPerSecond: 10000 },
                            };
                        } finally {
                            loading.value = false;
                        }
                    };

                    return {
                        urls,
                        transformations,
                        transformationNames,
                        loading,
                        error,
                        results,
                        activePreset,
                        addUrl,
                        removeUrl,
                        handleCompile,
                        JSON,
                    };
                },
            };

            /* ===================================================================
           COMPONENT - About / Vue Router Features Page
           Vue Pattern: Demonstrates useRoute(), route metadata, and
           serves as documentation for WHY Vue Router is worth using
           =================================================================== */
            const AboutPage = {
                template: `
                <div>
                    <h1>About Vue Router</h1>
                    <p class="mb-2" style="color: var(--text-muted)">
                        Vue Router is the official, first-party router for Vue.js. It deeply integrates
                        with Vue's reactivity system, making it the natural choice for any Vue SPA.
                    </p>

                    <!-- Live Route Inspector - demonstrates useRoute() -->
                    <div class="route-info">
                        <div>üìç <strong>Current path:</strong> <span>{{ route.path }}</span></div>
                        <div>üè∑Ô∏è  <strong>Route name:</strong> <span>{{ route.name }}</span></div>
                        <div>üìÑ <strong>Page title:</strong> <span>{{ route.meta.title }}</span></div>
                    </div>

                    <div class="alert alert-info mb-2">
                        <strong>‚ÑπÔ∏è Vue Pattern:</strong> The live inspector above uses <code>useRoute()</code>
                        to reactively read the current route's path, name, and custom metadata ‚Äî all updated
                        automatically when navigation occurs.
                    </div>

                    <!-- Feature grid: WHY Vue Router -->
                    <h2 style="margin-bottom: 16px;">Why Vue Router?</h2>
                    <div class="feature-grid">
                        <div class="feature-card">
                            <h4>üîó Declarative Navigation</h4>
                            <p>
                                Replace brittle <code>&lt;a href&gt;</code> tags with
                                <code>&lt;router-link&gt;</code>. Links automatically receive an
                                <code>router-link-active</code> class when their route is current ‚Äî no manual
                                class toggling required.
                            </p>
                        </div>
                        <div class="feature-card">
                            <h4>üß≠ Programmatic Navigation</h4>
                            <p>
                                Navigate from JavaScript with <code>router.push()</code>,
                                <code>router.replace()</code>, and <code>router.go()</code>. Pass
                                route params, query strings, and state objects for rich navigation patterns.
                            </p>
                        </div>
                        <div class="feature-card">
                            <h4>üõ°Ô∏è Navigation Guards</h4>
                            <p>
                                Intercept every navigation with <code>router.beforeEach()</code> to enforce
                                authentication, confirm unsaved changes, or track analytics ‚Äî without
                                scattering that logic across components.
                            </p>
                        </div>
                        <div class="feature-card">
                            <h4>üì¶ Route Parameters</h4>
                            <p>
                                Embed data directly in URLs with <code>/compiler/:preset</code>. Parameters
                                are exposed via <code>useRoute().params</code> and trigger computed properties
                                automatically when the URL changes.
                            </p>
                        </div>
                        <div class="feature-card">
                            <h4>üóÇÔ∏è Route Metadata</h4>
                            <p>
                                Attach arbitrary data to routes with the <code>meta</code> field (e.g., page
                                title, required roles, breadcrumb labels). Guards and components can read this
                                metadata at any time via <code>route.meta</code>.
                            </p>
                        </div>
                        <div class="feature-card">
                            <h4>‚ö° Lazy-Loaded Routes</h4>
                            <p>
                                In a Vite/webpack build, define routes as
                                <code>component: () => import('./Page.vue')</code> to split each route into
                                its own chunk ‚Äî keeping the initial bundle small and first-load fast.
                            </p>
                        </div>
                        <div class="feature-card">
                            <h4>üîÑ Nested Routes</h4>
                            <p>
                                Build complex layouts with nested <code>&lt;router-view&gt;</code> outlets.
                                Parent routes provide shared UI (headers, sidebars) while child routes swap
                                only the inner content.
                            </p>
                        </div>
                        <div class="feature-card">
                            <h4>üèóÔ∏è Named Routes & Views</h4>
                            <p>
                                Give routes stable names to decouple navigation from URL structure.
                                Named views allow multiple <code>&lt;router-view name="..."&gt;</code>
                                outlets in the same layout for sidebar/main-content patterns.
                            </p>
                        </div>
                    </div>

                    <!-- Navigation guard note -->
                    <div class="alert alert-success">
                        <strong>‚úÖ Live guard active:</strong> A <code>router.beforeEach()</code> guard is
                        running on every navigation in this PoC. Open the browser console to see it log each
                        route transition ‚Äî demonstrating how cross-cutting concerns (auth, analytics, titles)
                        are handled in one place rather than in every component.
                    </div>
                </div>
            `,
                setup() {
                    const route = useRoute();
                    return { route };
                },
            };

            /* ===================================================================
           COMPONENT - 404 Not Found Page
           Vue Pattern: Catch-all route for invalid paths
           =================================================================== */
            const NotFoundPage = {
                template: `
                <div style="text-align: center; padding: 60px 20px;">
                    <div style="font-size: 80px; margin-bottom: 20px;">üîç</div>
                    <h1 style="margin-bottom: 12px;">404 - Page Not Found</h1>
                    <p class="mb-2" style="color: var(--text-muted)">
                        The page <code>{{ route.path }}</code> does not exist.
                    </p>
                    <button class="btn btn-primary" @click="router.push('/')">Go Home</button>
                </div>
            `,
                setup() {
                    const route = useRoute();
                    const router = useRouter();
                    return { route, router };
                },
            };

            /* ===================================================================
           ROUTER CONFIGURATION
           Vue Pattern: Declarative routing with Vue Router 4
           Demonstrates: named routes, route metadata, params, and catch-all
           =================================================================== */
            const routes = [
                {
                    path: '/',
                    name: 'home',
                    component: HomePage,
                    meta: { title: 'Dashboard' },
                },
                {
                    path: '/compiler/:preset?',
                    name: 'compiler',
                    component: CompilerPage,
                    meta: { title: 'Compiler' },
                },
                {
                    path: '/about',
                    name: 'about',
                    component: AboutPage,
                    meta: { title: 'About Vue Router' },
                },
                {
                    // Catch-all 404 route ‚Äî must be last
                    path: '/:pathMatch(.*)*',
                    name: 'not-found',
                    component: NotFoundPage,
                    meta: { title: '404 Not Found' },
                },
            ];

            const router = createRouter({
                history: createWebHashHistory(),
                routes,
            });

            /* ===================================================================
           NAVIGATION GUARD
           Vue Pattern: router.beforeEach() for cross-cutting concerns.
           Why it's worth using: centralises auth checks, analytics, and
           document-title updates in ONE place instead of every component.
           =================================================================== */
            router.beforeEach((to, from) => {
                // Update document title from route metadata
                if (to.meta && to.meta.title) {
                    document.title = `${to.meta.title} ‚Äî Adblock Compiler`;
                }
                // PoC demo: in production, use a logging service or analytics SDK
                console.log(`[Vue Router] Navigating: ${from.path} ‚Üí ${to.path} (name: "${to.name}")`);
                // Return true (or nothing) to allow navigation; return false to cancel
                return true;
            });

            /* ===================================================================
           ROOT COMPONENT - Application Entry Point
           Vue Pattern: App shell with router-view for nested routing
           =================================================================== */
            const App = {
                template: `
                <div class="app-container">
                    <navigation />
                    <main class="main-content">
                        <router-view />
                    </main>
                </div>
            `,
                components: {
                    Navigation,
                },
            };

            /* ===================================================================
           BOOTSTRAP - Create and Mount Vue App
           =================================================================== */
            const app = createApp(App);
            app.use(router);
            app.mount('#app');
        </script>
    </body>
</html>
